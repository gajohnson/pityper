<!doctype html>
<html>
<head>
	<title>PITYPER</title>
	<style>
		body {
			background: #E5E5E5;
			color: #444;
			font-family: monospace;
			word-wrap: break-word;
			font-size: 1.75em;
			line-height:1.5em;
		}
		h1, h4 {
			text-align:center;
			font-family: Helvetica;
			color:#777;
		}
		.threePoint {
			color:#222;
			font-family: Georgia;
			font-size: 2.25em;
			width: 500px;
			margin: 0 auto;
			left: -1em;
			position: relative;
			height: 0;
		}
		.digits {
			width: 20em;
			margin: 0 auto;
			top: 0.75em;
			position: relative;
		}
	</style>
</head>
<body>
	<h1>&pi; Typer</h1>
	<h4>Type all the &pi;!</h4>
	<div class='threePoint'>3.</div>
	<script type='text/javascript'>
		var digitsNode = document.createElement('div');
		digitsNode.className = 'digits';
		document.body.appendChild(digitsNode);

		var digits = 0;
		var a = [];
		var b = 0, d = 0, g = 0, h = 0;;
		var f = 1000;
		var c = 52514;
		var lock = false;
		var triplet = '';

		var nextThree = function() {
			if(digits >= 10000 || lock) return;
			lock = true;

			b = c -= 14;
			if (!b) return;

			var e = d %= f;
			while(g = --b * 2) {
				d = d * b + f * (h ? a[b] : Math.floor(f/5));
				a[b] = d % --g;
				d = Math.floor(d/g);
			}
			var x = e + Math.floor(d/f);
			if (x > 999) {
				x += buf.pop()*1000;
			}
			var str = x.toString();
			while(str.length < 3) {
				str = '0' + str;
			}
			h = str.length;
			while(str.length > 0) {
				buf.push(parseInt(str.charAt(0)));
				str = str.substring(1);
			}

			lock = false;
		}

		var handleKeydown = function(keycode) {
			if (keycode > 47 && keycode < 58 && buf.length) {
				if (digits < 10000) {
					digitsNode.innerText += buf.shift().toString();
				}
				digits++;

				if (digits % 30 == 0) {
					digitsNode.innerHTML += '<br />';
				} else if (digits % 10 == 0) {
					digitsNode.innerHTML += '&nbsp;';
				}
				if (buf.length < 3) {
					nextThree();
				}
			}
		}

		var buf = [];
		nextThree();
		buf.shift();
		window.addEventListener('keydown', function(e) {
			handleKeydown(e.keyCode);
		});
		
		
	</script>
</body>
</html>